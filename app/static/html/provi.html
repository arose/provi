<!DOCTYPE html>

<html lang="en">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="shortcut icon" href="../favicon.ico">
    
    <title>Provi</title>
    
    <!--<script type="text/javascript" src="../js/lib/ba-debug.min.js"></script>-->
    <script type="text/javascript" src="../js/lib/stacktrace.min.js"></script>
    
    <script type="text/javascript" src="../js/lib/underscore-min.js"></script>
    
    <script type="text/javascript" src="../js/lib/jquery.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.query.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.mousewheel.min.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.blockUI.js"></script>
    <script type="text/javascript" src="../js/lib/jquery-splitter/splitter.js"></script>
    <script type="text/javascript" src="../js/lib/jquery-ui/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../js/lib/jstree/jquery.jstree.js"></script>
    <script type="text/javascript" src="../js/lib/chosen/chosen.jquery.js"></script>
    
    <script type="text/javascript" src="../js/lib/tipsy/src/javascripts/jquery.tipsy.js"></script>
    
    <script type="text/javascript" src="../js/lib/jquery.sizes.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.grid.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.border.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.flexgrid.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.jlayout.js"></script>
    
    <script type="text/javascript" src="../js/lib/sylvester.js"></script>
    
    <!--[if IE]><script type="text/javascript" src="../js/lib/svg.js" data-path="../js/lib/"></script><![endif]-->
    <script type="text/javascript" src="../js/lib/protovis-r.js"></script>
    <!--<script type="text/javascript" src="../js/lib/protovis.min.js"></script>-->
    <script type="text/javascript" src="../js/lib/pv.Behavior.tipsy.js"></script>
    
    <script type="text/javascript" src="../js/lib/plupload/js/plupload.full.min.js"></script>
    
    <script type="text/javascript" src="../js/lib/base64.js"></script>
    
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.image.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.symbol.js"></script>
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../js/lib/flot/excanvas.min.js"></script><![endif]-->
    
    <script type="text/javascript" src="../js/Provi.js"></script>
    <script type="text/javascript" src="../js/Provi.Debug.js"></script>
    <script type="text/javascript" src="../js/Provi.Utils.js"></script>
    <script type="text/javascript" src="../js/Provi.Utils.Protovis.js"></script>
    <script type="text/javascript" src="../js/Provi.Widget.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Selection.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Bio.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Smcra.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Structure.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Voronoia.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Rotamers.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.MembranePlanes.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.TransmembraneHelices.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Indices.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Sequence.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.HydrogenBonds.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.InterfaceContacts.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Isosurface.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Jmol.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Controls.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Analysis.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Modeling.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Data.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.Galaxy.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.Get.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.Jmol.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.StructureMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.InterfaceContactsMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.MplaneMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.IsosurfaceMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.ScriptMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.StoryMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.TmHelicesMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.NdxMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.HbondsMixin.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.VoronoiaMixin.js"></script>
    
    <link rel="stylesheet" media="screen" type="text/css" href="../js/lib/jquery-colorPicker/colorPicker.css" />
    <script type="text/javascript" src="../js/lib/jquery-colorPicker/jquery.colorPicker.js"></script>
    
    <link type="text/css" href="../js/lib/jquery-ui/css/smoothness/jquery-ui.css" rel="stylesheet" />
    <link type="text/css" href="../js/lib/tipsy/src/stylesheets/tipsy.css" rel="stylesheet" />
    <link type="text/css" href="../js/lib/chosen/chosen.css" rel="stylesheet" />
    <link rel='stylesheet' type='text/css' href='../css/view.css'>
    <!--[if IE 6]><link rel='stylesheet' type='text/css' href='../css/view_ie6.css'><![endif]-->
</head>
<body>
    <script type="text/javascript">
	
	Provi.Debug.auto();
	
	Provi.defaults.dom_parent_ids = $.extend( Provi.defaults.dom_parent_ids, {
	    DATASET_WIDGET: 'tab_widgets',
	    CANVAS_WIDGET: 'main',
	    SELECTION_WIDGET: 'tab_tree',
	    BUILDER_WIDGET: 'tab_tree'
	});
	
	function layout_main() {
            var n = Provi.Jmol.get_applet_list().length;
            var i = Math.round( Math.sqrt(n) );
            //$('#main').layout({resize: false, type: 'flexGrid', columns: i, rows: i, vgap: 8, hgap: 8 });
	    $('#main').layout({resize: false, type: 'grid', columns: i, rows: i, vgap: 8, hgap: 8 });
        }
	
	//Provi.Jmol.init("../applet/jmol/11.8.25/");
	//Provi.Jmol.init("../applet/jmol/11.8.26/");
	//Provi.Jmol.init("../applet/jmol/12.0.8/");
	//Provi.Jmol.init("../applet/jmol/12.0.40/", true);
	//Provi.Jmol.init("../applet/jmol/12.1.10/");
	//Provi.Jmol.init("../applet/jmol/12.1.23/");
	//Provi.Jmol.init("../applet/jmol/2010-11-23/", true);
	//Provi.Jmol.init("../applet/jmol/12.1.28/", true);
	//Provi.Jmol.init("../applet/jmol/2011-01-06/");
	//Provi.Jmol.init("../applet/jmol/12.1.35/", true);
	//Provi.Jmol.init("../applet/jmol/12.1.41/", true);
	//Provi.Jmol.init("../applet/jmol/12.1.42/", true);
	//Provi.Jmol.init("../applet/jmol/2011-04-22/", true);
	//Provi.Jmol.init("../applet/jmol/12.1.51/", true);
	Provi.Jmol.init("../../jmol/current/13/", true);
	
        $(document).ready(function(){
	    
	//    $.blockUI({
	//	message: 'loading...',
	//	forceIframe: true
	//    });
	    
	//    // hack to get session cookie
	//    $.ajax({
	//	url: '../../data/index/',
	//	async: false,
	//	dataType: 'text',
	//	cache: false,
	//	success: function(response){
	//	    console.log( response );
	//	}
	//    });
	    
	    Provi.Utils.event.init();
	    
            var container = $('#container');
            var main = $('#main');
            var tabs_panel = $('#tabs_panel');
	    
            
            layout_main();
            
            tabs_panel.tabs({ cookie: { expires: 30 } });
            tabs_panel.children('ul').removeClass('ui-corner-all');
            
            // Hook up the re-layout to the window resize event.
            $(window).resize(layout_main);
            $('#jmolWindow').resize(layout_main);
            
            
            Provi.Jmol.Applet.prototype.default_params.height = "100%";
            Provi.Jmol.Applet.prototype.default_params.width = "100%";
            Provi.Jmol.JmolWidget.prototype.default_params = $.extend(
		Provi.Jmol.JmolWidget.prototype.default_params,
		{
		    parent_id: "main",
		    no_sequence_view_widget: true,
		    no_selection_manager_widget: true,
		    no_tree_view_widget: true
		}
	    );
            $(Provi.Jmol).bind('applet_list_change', layout_main);
            
	    new Provi.Jmol.Controls.JmolGlobalControlWidget({
                parent_id: 'tab_controls'
            });
	    
            new Provi.Jmol.Controls.JmolDisplayWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.LightingManagerWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.ClippingManagerWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.QualityManagerWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.PickingManagerWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.StyleManagerWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Modeling.JmolModelingWidget({
                parent_id: 'tab_controls'
            });
            
            new Provi.Bio.Rotamers.RotamersWidget({
                parent_id: 'tab_controls'
            });
	    
//	    new Provi.Jmol.Analysis.RamachandranPlotWidget({
//                parent_id: 'tab_widgets'
//            });
	    
	    new Provi.Jmol.Analysis.HbondsWidget({
                parent_id: 'tab_widgets'
            });
            
	    new Provi.Jmol.Analysis.IsosurfaceConstructionWidget({
		parent_id: 'tab_tree'
	    });
	    
	//    new Provi.Bio.Sequence.TreeViewWidget({
	//	parent_id: 'tab_tree'
	//    });
	    
	    new Provi.Jmol.Controls.JmolAnimationWidget({
                parent_id: 'tab_controls'
            });
	    
	    new Provi.Jmol.Controls.JmolConsoleWidget({
                parent_id: 'tab_controls'
            });
	    
            
            // load
            
            var plupload = new Provi.Data.Io.PluploadLoadWidget({
                parent_id: 'tab_load'
            });
	    
	    new Provi.Data.Io.UrlLoadWidget({
                parent_id: 'tab_load'
            });
	    
	    new Provi.Data.Io.PdbLoadWidget({
                parent_id: 'tab_load'
            });
	    
            new Provi.Data.Io.ExampleLoadWidget({
                parent_id: 'tab_load'
            });
            
//	    new Provi.Data.Io.Galaxy.GalaxyLoadWidget({
//                parent_id: 'tab_load'
//            });
	    
	    
	    // calculate
	    
	    new Provi.Data.Io.Jmol.CalculateWidget({
                parent_id: 'tab_save'
            });
            
	    
            // save
            
            new Provi.Data.Io.SaveDataWidget({
                parent_id: 'tab_save'
            });
            
            //new Provi.Data.Io.Galaxy.SaveGalaxyWidget({
            //    parent_id: 'tab_save'
            //});
            
            new Provi.Data.Io.SaveExampleWidget({
                parent_id: 'tab_save'
            });
            
            
            // data
            
	    new Provi.Data.DatasetManagerWidget({
                parent_id: 'tab_data'
            });
            
            $('#tab_scrollbox').scroll(function (event, ui) {
                $(this).data('scrollTop-tab-' + tabs_panel.tabs('option', 'selected'), $(this).scrollTop());
            });
            
            tabs_panel.bind('tabsshow', function(event, ui) {
                var scrollTop = $('#tab_scrollbox').data('scrollTop-tab-' + ui.index);
                if(!scrollTop) scrollTop = 0;
                $('#tab_scrollbox').scrollTop( scrollTop );
                if(ui.index == 3){
                    plupload.uploader.refresh();
                }
            });
            
            $("#container").splitter({
                type: "v",
                outline: true,
                resizeToWidth: true,
                cookie: "vsplitter",
                anchorToWindow: true,
                sizeRight: true
            }).mousedown( function(edown){
		$(edown.target).one('mouseup', function(eup){
		    //if( edown.clientX == eup.clientX ) console.log('not moved');
		});
	    });
	    
	    $('#tabs_panel a[title]:last').tipsy({ gravity: 'ne' });
	    $('#tabs_panel a[title]:first').tipsy({ gravity: 'nw' });
	    $('#tabs_panel a[title]').tipsy({ gravity: 'n' });
	    
	    
	    // when in test mode, load some data for development purposes
	    if( !Provi.Data.Io.Get.init({parent_id: 'main'}) && $.query.get('test') ){
		var applet = Provi.Jmol.get_default_applet( true );
		
		if( $.query.get('test') == '2rdd' ){
		    
		    Provi.Data.Io.import_example( 'showcase', 'test/2rdd.mbn', 'mbn', {
			sort_key: 1,
			heading: 'Interface Contacts',
			info: 'Infotext',
			description: 'Description',
			applet: applet,
			load_as: 'new'
		    });
		
		}else if( $.query.get('test') == '2a65' ){
		    
		    Provi.Data.Io.import_example( 'showcase', 'test/2a65.mbn', 'mbn', {
			sort_key: 1,
			heading: 'Interface Contacts',
			info: 'Infotext',
			description: 'Description',
			applet: applet,
			load_as: 'new'
		    });
		    
		    Provi.Data.Io.import_example( 'showcase', 'test/2a65.anal', 'anal', {
			sort_key: 4,
			heading: 'Hydrogen Bonds',
			applet: applet
		    });
		
		}else if( $.query.get('test') == '1ar1' ){
		    
		    Provi.Data.Io.import_example( 'showcase', 'test/1ar1.mbn', 'mbn', {
			sort_key: 1,
			heading: 'Interface Contacts',
			info: 'Infotext',
			description: 'Description',
			applet: applet,
			load_as: 'new'
		    });
		
		}else if( $.query.get('test') == '1xio' ){
		    
		    Provi.Data.Io.import_example( 'showcase', 'test/1xio.mbn', 'mbn', {
			sort_key: 1,
			heading: 'Interface Contacts',
			info: 'Infotext',
			description: 'Description',
			applet: applet,
			load_as: 'new'
		});
		    
		}else{
		
		    var ic_ds = Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mbn', 'mbn', {
		    //Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.pdb', 'pdb', {
			sort_key: 1,
			heading: 'Interface Contacts',
			info: 'Infotext',
			description: 'Description',
			applet: applet,
			load_as: 'new'
		    });
		    
		    $(ic_ds).bind('widget_created', function(event, widget){
			if( widget instanceof Provi.Bio.InterfaceContacts.InterfaceContactsWidget ){
			    $(ic_ds).unbind('widget_created', event);
			    var load_ds = function(){
				Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mplane', 'mplane', {
				    sort_key: 2,
				    heading: 'Membrane Planes',
				    applet: applet
				});
				Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.tmhelix', 'tmhelix', {
				    sort_key: 3,
				    heading: 'Transmembrane Helices',
				    applet: applet
				});
				Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.anal', 'anal', {
				    sort_key: 4,
				    heading: 'Hydrogen Bonds',
				    applet: applet
				});
			    }
			    if( widget.initialized ){
				load_ds();
			    }else{
				$(widget).bind('init', function(event){
				    $(widget).unbind('init');
				    load_ds();
				});
			    }
			}
		    });
		    
		}
	    }
	    
	    // add some showcase examples
	    $('#showcase_examples ').append(
		$('<li class="load_example"><a>Voronoia results for PDB 2xc2</a></li>').click( function(){
		    Provi.Data.Io.import_example( 'showcase', 'voronoia/2xc2.vol', 'vol', { applet: Provi.Jmol.get_default_applet( true ), load_as: 'new' } );
		})
	    );
	    $('#showcase_examples').append(
		$('<li class="load_example"><a>MPlot results for PDB 3dqb</a></li>').click( function(){
		    var applet = Provi.Jmol.get_default_applet( true );
		    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mbn', 'mbn', { applet: applet, load_as: 'new' } );
		    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mplane', 'mplane', { applet: applet } );
		    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.tmhelix', 'tmhelix', { applet: applet } );
		    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.anal', 'anal', { applet: applet } );
		})
	    );
	    $('#showcase_examples').append(
		$('<li class="load_example"><a>A crystallographic map</a></li>').click( function(){
		    var applet = Provi.Jmol.get_default_applet( true );
		    Provi.Data.Io.import_example(
			'showcase', 'crystal_map/Test.pdb', 'pdb',
			{
			    applet: applet,
			    load_as: 'new',
                            style: 'wireframe only; wireframe 0.10; set ambientPercent 100; set diffusePercent 0; set specular OFF;'
			    //style: 'wireframe only; wireframe 0.2;'
			}
		    );
		    Provi.Data.Io.import_example(
			'showcase', 'crystal_map/2fo-fc_map_sigma1.0.jvxl', 'jvxl',
			{
			    applet: applet,
			    color: 'orange',
			    style: 'mesh nofill nodots',
			    within: '2 {protein}',
			    focus: true,
			    sele: 'atomNo=1'
			}
		    );
		//    Provi.Data.Io.import_example(
		//	'showcase', 'crystal_map/2fo-fc_map_sigma1.5.jvxl', 'jvxl',
		//	{
		//	    applet: applet,
		//	    color: 'orange',
		//	    style: 'mesh nofill nodots',
		//	    within: '2 {protein}'
		//	}
		//    );
		//    Provi.Data.Io.import_example(
		//	'showcase', 'crystal_map/2fo-fc_map_sigma2.0.jvxl', 'jvxl',
		//	{
		//	    applet: applet,
		//	    color: 'red',
		//	    style: 'mesh nofill nodots',
		//	    within: '2 {protein}'
		//	}
		//    );
		})
	    );
	    $('#showcase_examples').append(
		$('<li class="load_example"><a>Multiple rhodpson/opsin structrues side by side</a></li>').click( function(){
		    $.each( ['1u19', '2g87', '2hpy', '3cap'], function(i, structure_name){
			var jw = new Provi.Jmol.JmolWidget({});
			Provi.Data.Io.import_example( 'showcase', 'rhodopsin/' + structure_name + '_aligned.pdb', 'pdb', { applet: jw.applet, load_as: 'new' } );
		    });
		    Provi.Jmol.get_default_applet().script( 'sync * on; sync * "set syncMouse on";' );
		})
	    );
	    
	    
	    //$.unblockUI();
	    
	    // accordion for about section
	    //$('#tab_about .accordion').accordion();
        });
        
    </script>
    
    <div id="container" style="height:100%; width:100%;">
        
        <div id="jmolWindow" class="" style="overflow:hidden; height:100% ">
            <div id="main" style="height:100%; width:100%; overflow:hidden;"></div>
        </div>
        
        <div id="jmolControls" class="" style="height:100%; width:400px; min-width:300px;">
            <div id="tabs" class="ui-tabs" style="overflow: auto; position: absolute; bottom: 0px; top: 0px; left: 0px; right 0px; width:100%;">
                <div id="tabs_panel" style="height:100%; width:100%;">
                    <ul>
			<li><a title="Infos about the protein viewer" href="#tab_about">About</a></li>
                        <li><a title="General controls" href="#tab_controls">Controls</a></li>
                        <li><a href="#tab_tree">Tree</a></li>
                        <li><a title="Load from various datasources" href="#tab_load">Load</a></li>
                        <li><a title="Save data" href="#tab_save">Save</a></li>
			<li><a title="A list of all imported data" href="#tab_data">Data</a></li>
			<li><a title="A collection of control elements" href="#tab_widgets">Widgets</a></li>
                    </ul>
                    <div id="tab_scrollbox" style="overflow: auto; position: absolute; bottom: 3px; top: 40px; width:100%;  right: 3px;">
			<div id="tab_about">
			    
			    <h4><i>Provi</i> integrates the display of protein structures and related data into a convenient graphical user interface (GUI).</h4>
			    <div class="accordion">
				<h3 class="ui-widget-header">For users</h3>
				<div>
				    <p>Click on the following examples to see for yourself. The <i>Widgets</i> tab provides GUI controls tailored to the displayed data. More general controls are found in the <i>Controls</i> and the <i>Tree</i> tab.</p>
				    <ul id="showcase_examples"></ul>
				</div>
				<div>
				    <p>If you experience problems with the Jmol Java Applet, there are several helpful resources available.</p>
				    <ul>
					<li><a href="http://www.java.com/en/download/testjava.jsp">Java Applets</a></li>
					<li><a href="http://jmol.sourceforge.net/browsercheck/">Jmol browser check</a></li>
					<li><a href="http://support.microsoft.com/kb/2506617">IE9 and Java 6 Update 22/23</a></li>
					<li><a href="http://www.mydigitallife.info/ie9-java-applet-not-loading-nor-working-blank-fix/">IE9, Java & ActiveX</a></li>
				    </ul>
				</div>
				<h3 class="ui-widget-header">For developers</h3>
				<div>
				    <p>Some documentation is available</p>
				    <ul>
					<li><a href="../doc/sphinx/_build/index.html" target="_new">Documentation</a></li>
					<li><a href="../doc/jsdoc/index.html" target="_new">JavaScript API</a></li>
				    </ul>
				</div>
			    </div>
			</div>
                        <div id="tab_controls"></div>
                        <div id="tab_tree"></div>
                        <div id="tab_load"></div>
                        <div id="tab_save"></div>
			<div id="tab_data"></div>
			<div id="tab_widgets"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="trash" style="display:hidden;"></div>
    
</body>
</html>
