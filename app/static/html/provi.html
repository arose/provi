<!DOCTYPE html>

<html lang="en">
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="shortcut icon" href="../favicon.ico">
    
    <title>Provi</title>
    
    <script type="text/javascript" src="../js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="../js/lib/underscore.inflection.js"></script>
    <script type="text/javascript" src="../js/lib/underscore.string.min.js"></script>
    
    <script type="text/javascript" src="../js/lib/canvg/rgbcolor.js"></script>
    <script type="text/javascript" src="../js/lib/canvg/canvg.js"></script>
    <script type="text/javascript" src="../js/lib/canvg/svgfix.js"></script>

    <script type="text/javascript" src="../js/lib/jquery.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.query.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.cookie.js"></script>
    <script type="text/javascript" src="../js/lib/jquery-splitter/splitter.js"></script>
    <script type="text/javascript" src="../js/lib/jquery-ui/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../js/lib/jstree/jquery.jstree.js"></script>

    <link rel="stylesheet" media="screen" type="text/css" href="../js/lib/qtip2/jquery.qtip.min.css" />
    <script type="text/javascript" src="../js/lib/qtip2/jquery.qtip.min.js"></script>

    <script type="text/javascript" src="../js/lib/jquery.sizes.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.grid.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.border.js"></script>
    <script type="text/javascript" src="../js/lib/jlayout.flexgrid.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.jlayout.js"></script>
    
    <script type="text/javascript" src="../js/lib/sylvester.js"></script>
    <script type="text/javascript" src="../js/lib/numeric.js"></script>
    
    <script type="text/javascript" src="../js/lib/plupload/js/plupload.full.js"></script>
    
    <script type="text/javascript" src="../js/lib/base64.js"></script>
    
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.image.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.symbol.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.selection.js"></script>
    <script type="text/javascript" src="../js/lib/flot/jquery.flot.navigate.js"></script>
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../js/lib/flot/excanvas.min.js"></script><![endif]-->
    
    <script type="text/javascript" src="../js/lib/d3/d3.v2.js"></script>

    <script type="text/javascript" src="../js/Provi.js"></script>
    <script type="text/javascript" src="../js/Provi.Debug.js"></script>
    <script type="text/javascript" src="../js/Provi.Utils.js"></script>
    <script type="text/javascript" src="../js/Provi.Widget.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Bio.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.AtomProperty.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.AtomSelection.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Alignment.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Helix.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.HydrogenBonds.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Structure.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Superposition.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Voronoia.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Rotamers.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.MembranePlanes.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.InterfaceContacts.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Isosurface.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Flatland.js"></script>
    <script type="text/javascript" src="../js/Provi.Bio.Mutate.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Jmol.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Settings.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Controls.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Analysis.js"></script>
    <script type="text/javascript" src="../js/Provi.Jmol.Modeling.js"></script>

    <script type="text/javascript" src="../js/Provi.Jalview.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Data.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Io.Jmol.js"></script>
    <script type="text/javascript" src="../js/Provi.Data.Controller.js"></script>
    
    <script type="text/javascript" src="../js/Provi.Job.js"></script>

    <link rel="stylesheet" media="screen" type="text/css" href="../js/lib/jquery-colorPicker/colorPicker.css" />
    <script type="text/javascript" src="../js/lib/jquery-colorPicker/jquery.colorPicker.js"></script>
    
    <link rel="stylesheet" href="../js/lib/slickgrid/slick.grid.css" type="text/css" media="screen" charset="utf-8" />
    <script language="JavaScript" src="../js/lib/slickgrid/lib/jquery.event.drag-2.0.min.js"></script>
    <script language="JavaScript" src="../js/lib/slickgrid/slick.core.js"></script>
    <script language="JavaScript" src="../js/lib/slickgrid/slick.editors.js"></script>
    <script language="JavaScript" src="../js/lib/slickgrid/slick.grid.js"></script>
    
    <link type="text/css" href="../js/lib/jquery-ui/css/smoothness/jquery-ui.css" rel="stylesheet" />
    <link rel='stylesheet' type='text/css' href='../css/keys.css'>
    <link rel='stylesheet' type='text/css' href='../css/view.css'>
</head>
<body>
    <script type="text/javascript">
    
        _.extend( Provi.defaults.dom_parent_ids, {
            DATASET_WIDGET: 'tab_widgets',
            CANVAS_WIDGET: 'main',
            SELECTION_WIDGET: 'tab_tree',
            BUILDER_WIDGET: 'tab_tree',
            SETTINGS_WIDGET: 'tab_settings'
        });

        _.extend(
            Provi.Bio.Voronoia.VoronoiaSelectionType.prototype.default_params,
            {
                cavity_color: 'skyblue'
            }
        );
    
        function layout_main() {
            var n = Provi.Jmol.get_applet_list().length;
            var i = Math.round( Math.sqrt(n) );
            $('#main').layout({resize: false, type: 'grid', columns: i, rows: i, vgap: 8, hgap: 8 });
        }
    
        $(document).ready(function(){
        
            Provi.init();
        
            var container = $('#container');
            var main = $('#main');
            var tabs_panel = $('#tabs_panel');
        
            
            layout_main();
            
            tabs_panel.tabs({ cookie: { expires: 30 } });
            tabs_panel.children('ul').removeClass('ui-corner-all');
            
            // Hook up the re-layout to the window resize event.
            $(window).resize(layout_main);
            $('#jmolWindow').resize(layout_main);
            
            
            Provi.Jmol.Applet.prototype.default_params.height = "100%";
            Provi.Jmol.Applet.prototype.default_params.width = "100%";
            _.extend( Provi.Jmol.JmolWidget.prototype.default_params, {
                parent_id: "main",
                no_grid_widget: false
            });
            $(Provi.Jmol).bind('applet_list_change', layout_main);
            
            Provi.Jalview.Applet.prototype.default_params.height = "100%";
            Provi.Jalview.Applet.prototype.default_params.width = "100%";
            _.extend( Provi.Jalview.JalviewWidget.prototype.default_params, {
                parent_id: "main"
            });
            //$(Provi.Jalview).bind('applet_list_change', layout_main);
        
            new Provi.Jmol.Controls.JmolDisplayWidget({
                parent_id: 'tab_controls'
            });
        
            new Provi.Jmol.Modeling.JmolModelingWidget({
                parent_id: 'tab_controls'
            });
            
            new Provi.Bio.Rotamers.RotamersWidget({
                parent_id: 'tab_controls'
            });

            new Provi.Bio.Mutate.MutateWidget({
                parent_id: 'tab_controls'
            });
        
            // new Provi.Jmol.Analysis.RamachandranPlotWidget({
            //     parent_id: 'tab_widgets'
            // });

            new Provi.Bio.Superposition.SuperposeWidget({
                parent_id: 'tab_widgets'
            });

            new Provi.Jmol.Analysis.PlaneConstructionWidget({
                parent_id: 'tab_widgets'
            });

            // new Provi.Bio.Helix.GromacsHelixorientWidget({
            //     parent_id: 'tab_widgets',
            //     collapsed: true
            // });

            // new Provi.Bio.AtomSelection.GridWidget({
            //     parent_id: 'tab_widgets',
            //     type: "helixorient"
            // });

            new Provi.Bio.Flatland.FlatlandWidget({
                parent_id: 'tab_widgets',
                collapsed: true
            });

            // Provi.Data.Io.import_example( 'showcase', 'test/complete.prop', 'prop', {
            //     //sort_key: 2,
            //     heading: 'MPHD Propensities',
            //     description: 'Propensity data from curated MPHD data set',
            //     show_dataset_info: false,
            //     parent_id: 'tab_tree',
            //     collapsed: true,
            //     mphd: true
            // });

            // Provi.Data.Io.import_example( 'showcase', 'test/static_scales.prop', 'prop', {
            //     //sort_key: 2,
            //     heading: 'Various Propensities',
            //     description: 'Various propensity scales, see White S and Wimley W. Membrane protein folding and stability: physical principles. Annual review of biophysics and biomolecular structure. 1999;28:319-365.',
            //     show_dataset_info: false,
            //     parent_id: 'tab_tree',
            //     collapsed: true
            // });
                
            new Provi.Jmol.Analysis.IsosurfaceConstructionWidget({
                parent_id: 'tab_tree'
            });
        
            new Provi.Jmol.Controls.JmolAnimationWidget({
                parent_id: 'tab_controls',
                collapsed: true
            });
        
            new Provi.Jmol.Controls.JmolConsoleWidget({
                parent_id: 'tab_controls'
            });
        
            
            // load
            
            var plupload = new Provi.Data.Io.PluploadLoadWidget({
                parent_id: 'tab_io'
            });
        
            new Provi.Data.Io.UrlLoadWidget({
                parent_id: 'tab_io'
            });
        
            new Provi.Data.Io.PdbLoadWidget({
                parent_id: 'tab_io'
            });
        
            new Provi.Data.Io.ExampleLoadWidget({
                parent_id: 'tab_io'
            });

        
            // calculate
        
            new Provi.Data.Io.Jmol.CalculateWidget({
                parent_id: 'tab_io'
            });
            
        
            // save
            
            new Provi.Data.Io.SaveDataWidget({
                parent_id: 'tab_io'
            });
            
            new Provi.Data.Io.SaveExampleWidget({
                parent_id: 'tab_io'
            });
            
            
            // data
            
            new Provi.Data.DatasetManagerWidget({
                parent_id: 'tab_data'
            });
            


            $('#tab_scrollbox').scroll(function (event, ui) {
                $(this).data('scrollTop-tab-' + tabs_panel.tabs('option', 'selected'), $(this).scrollTop());
            });
            
            tabs_panel.bind('tabsshow', function(event, ui) {
                var scrollTop = $('#tab_scrollbox').data('scrollTop-tab-' + ui.index);
                if(!scrollTop) scrollTop = 0;
                $('#tab_scrollbox').scrollTop( scrollTop );
                if(ui.index == 3){
                    plupload.uploader.refresh();
                }
            });
            
            $("#container").splitter({
                type: "v",
                outline: true,
                resizeToWidth: true,
                cookie: "vsplitter",
                anchorToWindow: true,
                sizeRight: true
            }).mousedown( function(edown){
                $(edown.target).one('mouseup', function(eup){
                    //if( edown.clientX == eup.clientX ) console.log('not moved');
                });
            });
        
            $('#tabs_panel a[title]').qtip({ position: {my: 'top center', at: 'bottom center'} });
            $('#tabs_panel a[title]:last').qtip({ position: {my: 'top right', at: 'bottom center'} });
            $('#tabs_panel a[title]:first').qtip({ position: {my: 'top left', at: 'bottom center'} });
        
            // when in test mode, load some data for development purposes
            if( $.query.get('test') ){
                var applet = Provi.Jmol.get_default_applet( true );
                
                if( $.query.get('test') == '3dqb' ){
                    
                    Provi.Data.Io.import_example( 'showcase', 'rhodopsin/3dqb.pdb', 'pdb', {
                        applet: applet,
                        load_as: 'new'
                    });

                }else if( $.query.get('test') == '1gzm' ){
                    
                    Provi.Data.Io.import_example( 'showcase', 'mplot/1gzm_mod.pdb', 'pdb', {
                        applet: applet,
                        load_as: 'new'
                    });
       
                }
            }
            
            // add some showcase examples
            $('#showcase_examples').append(
                $('<li class="load_example"><a>MPlot results for PDB 3dqb</a></li>').click( function(){
                    var applet = Provi.Jmol.get_default_applet( true );
                    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mbn', 'mbn', { applet: applet, load_as: 'new' } );
                    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.mplane', 'mplane', { applet: applet } );
                    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.tmhelix', 'tmhelix', { applet: applet } );
                    Provi.Data.Io.import_example( 'showcase', 'mplot/3dqb.anal', 'anal', { applet: applet } );
                })
            );
            $('#showcase_examples').append(
                $('<li class="load_example"><a>A crystallographic map</a></li>').click( function(){
                    var applet = Provi.Jmol.get_default_applet( true );
                    Provi.Data.Io.import_example(
                        'showcase', 'crystal_map/Test.pdb', 'pdb',
                        {
                            applet: applet,
                            load_as: 'new',
                                        style: 'wireframe only; wireframe 0.10; set ambientPercent 100; set diffusePercent 0; set specular OFF;'
                            //style: 'wireframe only; wireframe 0.2;'
                        }
                    );
                    Provi.Data.Io.import_example(
                        'showcase', 'crystal_map/2fo-fc_map_sigma1.0.jvxl', 'jvxl',
                        {
                            applet: applet,
                            color: 'orange',
                            style: 'mesh nofill nodots',
                            within: '2 {protein}',
                            focus: true,
                            sele: 'atomNo=1'
                        }
                    );
                })
            );
            
        });
        
    </script>
    
    <div id="container" style="height:100%; width:100%;">
        
        <div id="jmolWindow" class="" style="overflow:hidden; height:100% ">
            <div id="main" style="height:100%; width:100%; overflow:hidden;"></div>
        </div>
        
        <div id="jmolControls" class="" style="height:100%; width:400px; min-width:300px;">
            <div id="tabs" class="ui-tabs" style="overflow: auto; position: absolute; bottom: 0px; top: 0px; left: 0px; right 0px; width:100%;">
                <div id="tabs_panel" style="height:100%; width:100%;">
                    <ul>
                        <li><a title="Infos about the protein viewer" href="#tab_about">
                            <span class="ui-icon ui-icon-help"></span>
                            <!--<span style="height:19px; display:block;">About</span>-->
                        </a></li>
                        <li><a title="General controls" href="#tab_controls">
                            <span style="height:19px; display:block;">Controls</span>
                        </a></li>
                        <li><a href="#tab_tree">
                            <span style="height:19px; display:block;">Tree</span>
                        </a></li>
                        <li><a title="Save/Load data" href="#tab_io">
                            <span style="height:19px; display:block;">I/O</span>
                        </a></li>
                        <li><a title="A list of all imported data" href="#tab_data">
                            <span style="height:19px; display:block;">Data</span>
                        </a></li>
                        <li><a title="A collection of control elements" href="#tab_widgets">
                            <span style="height:19px; display:block;">Widgets</span>
                        </a></li>
                        <li><a title="Settings" href="#tab_settings">
                            <span class="ui-icon ui-icon-gear"></span>
                        </a></li>
                    </ul>
                    <div id="tab_scrollbox" style="overflow: auto; position: absolute; bottom: 3px; top: 40px; width:100%;  right: 3px;">
                        <div id="tab_about">
                
                            <h4><i>Provi</i> integrates the display of protein structures and related data into a convenient graphical user interface (GUI).</h4>
                            <div class="accordion">
                                <h3 class="ui-widget-header">For users</h3>
                                <div>
                                    <p>Click on the following examples to see for yourself. The <i>Widgets</i> tab provides GUI controls tailored to the displayed data. More general controls are found in the <i>Controls</i> and the <i>Tree</i> tab.</p>
                                    <ul id="showcase_examples"></ul>
                                </div>
                                <div>
                                    <p>If you experience problems with the Jmol Java Applet, there are several helpful resources available.</p>
                                    <ul>
                                    <li><a href="http://www.java.com/en/download/testjava.jsp">Java Applets</a></li>
                                    <li><a href="http://jmol.sourceforge.net/browsercheck/">Jmol browser check</a></li>
                                    </ul>
                                </div>
                                <h3 class="ui-widget-header">For developers</h3>
                                <div>
                                    <p>Some documentation is available</p>
                                    <ul>
                                    <li><a href="../doc/sphinx/_build/index.html" target="_new">Documentation</a></li>
                                    <li><a href="../doc/jsdoc/index.html" target="_new">JavaScript API</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div id="tab_controls"></div>
                        <div id="tab_tree"></div>
                        <div id="tab_io"></div>
                        <div id="tab_data"></div>
                        <div id="tab_widgets"></div>
                        <div id="tab_settings"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="trash" style="display:hidden;"></div>
    
</body>
</html>
